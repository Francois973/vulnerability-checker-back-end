
require 'test_helper'

class FindVulnerabilitiesProjectServiceTest < ActiveSupport::TestCase
  test "should create project vulnerabilities" do
    project = Project.create(name: 'rails-mediless', url: "https://github.com/francois973/rails-mediless")
    vulnerabilities = []
    5.times do
      vulnerabilities << vulnerability = Vulnerability.create(stack: 'rails', details: "Problem with something about rails gem", summary: "whatever", version_ranges: [{ version: "5.2.0", comparator: ">="}, {version: "7.0.3", comparator: "<"}], ecosystem: "RUBYGEMS")
    end

    result = FindVulnerabilitiesProjectService.new(vulnerabilities, project).call

    assert result.is_a?(Array)
    assert result.first.stack = "rails"
    assert_not result != project.vulnerabilities
  end
end
