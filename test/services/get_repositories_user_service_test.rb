require 'test_helper'

class GetRepositoriesUserServiceTest < ActiveSupport::TestCase
  WebMock.allow_net_connect!

  test "should find repositories of a user from username" do
    stub_request(:get, "https://api.github.com/users/Francois973/repos").
      to_return(status: 200, body: file_fixture("Repositories_valid.json").read)

      result = GetRepositoriesUserService.new("Francois973").call

      assert_equal "Francois973", result[:owner]

      assert_equal "https://github.com/Francois973/Airbnplane", result[:repositories][0][:url]
      assert_equal "Airbnplane", result[:repositories][0][:name]
      assert_equal 79202, result[:repositories][0][:languages]["Ruby"]
      assert_equal 30530, result[:repositories][0][:languages]["HTML"]
      assert_equal 11755, result[:repositories][0][:languages]["SCSS"]
      assert_equal 1733, result[:repositories][0][:languages]["JavaScript"]
      assert_equal 230, result[:repositories][0][:languages]["Shell"]
  end
end
