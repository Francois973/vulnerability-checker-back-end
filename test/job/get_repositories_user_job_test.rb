require "test_helper"

class GetRepositoriesUserJobTest < ActiveJob::TestCase
  WebMock.allow_net_connect!

  test "should find repositories of a user from username" do
    stub_request(:get, "https://api.github.com/users/Francois973/repos").
      to_return(status: 200, body: file_fixture("Repositories_valid.json").read)

      username = "Francois973"

      result = GetRepositoriesUserJob.perform_now(username)

      assert_equal [{
            :name => "Airbnplane",
            :url => "https://github.com/Francois973/Airbnplane",
            :languages => [{
                "Ruby" => 79202,
                "HTML" => 30530,
                "SCSS" => 11755,
          "JavaScript" => 1733,
                "Shell" => 230
          }]
      }], result
  end
end
