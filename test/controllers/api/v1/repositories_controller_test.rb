require "test_helper"
require 'minitest/autorun'

class Api::V1::RepositoriesControllerTest < ActionDispatch::IntegrationTest
  WebMock.allow_net_connect!

  test "should return success reponse" do
    get "/api/v1/repositories/Francois973", as: :json

    assert_response :success
    assert_response 200
  end

  test "sould find repositories" do
    get "/api/v1/repositories/Francois973", as: :json

    result = JSON.parse(response.body)

    assert_equal "Francois973", result["owner"]
    assert_equal 13, result["repositories"].size
    assert_equal "Airbnplane", result["repositories"][0]["name"]
    assert_equal "https://github.com/Francois973/Airbnplane", result["repositories"][0]["url"]
    assert_equal 79202, result["repositories"][0]["languages"]["Ruby"]
    assert_equal 30530, result["repositories"][0]["languages"]["HTML"]
    assert_equal 11755, result["repositories"][0]["languages"]["SCSS"]
    assert_equal 1733, result["repositories"][0]["languages"]["JavaScript"]
    assert_equal 230, result["repositories"][0]["languages"]["Shell"]
  end
end
