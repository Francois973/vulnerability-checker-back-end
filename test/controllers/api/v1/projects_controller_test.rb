require "test_helper"
require 'minitest/autorun'

class Api::V1::ProjectsControllerTest < ActionDispatch::IntegrationTest

  test "should create project with valid params" do
    post api_v1_projects_path, params: { url: "https://github.com/francois973/rails-mediless"}, as: :json
    assert_response :success
    assert_response 201
    body = JSON.parse(response.body)
    assert body["uuid"]
    assert_equal body["url"], "https://github.com/francois973/rails-mediless"
    assert_equal body["status"], "New"
    assert_nil body["id"]
    assert_enqueued_with(job: VulnerabilityCheckerJob)
  end

  test "should destroy in database" do
    project = Project.create(name: "rails-mediless", url: "https://github.com/francois973/rails-mediless")
    delete_project = project.destroy

    assert delete_project
  end

  test 'should return a json of vulnerabilities project' do
    project = Project.create(name: "rails-mediless", url: "https://github.com/francois973/rails-mediless")

    assert project.vulnerabilities, as: :json
  end
end
