require "test_helper"
require "rake"


class ProjectCreatedTest < ActiveSupport::TestCase

  setup do
    Project.create!(url: "https://github.com/francois973/rails-mediless", name: "rails-mediless")
    VulnerabilityChecker::Application.load_tasks
    Rake::Task['delete_project_created:clean_db_everyday'].invoke
  end

  test "task should destroy olds projects" do
    if Project.find_by(created_at: ..1.day.ago)
      assert_nil Project.find_by(url: "https://github.com/francois973/rails-mediless"), nil
    else
      assert Project.find_by(url: "https://github.com/francois973/rails-mediless")
    end
  end
end
