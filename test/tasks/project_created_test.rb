require "test_helper"


class ProjectCreatedTest < ActiveSupport::TestCase
  setup do
    Project.create!(url: "https://github.com/francois973/rails-mediless", name: "rails-mediless")
    Project.create!(url: "https://github.com/francois973/rails-mediless", name: "rails-mediless", created_at: 2.days.ago)
    VulnerabilityChecker::Application.load_tasks
  end

  test "task should destroy olds projects" do
    assert_equal Project.count, 4
    Rake::Task['delete_project_created:clean_db_everyday'].invoke
    assert_equal Project.count, 3
  end
end
