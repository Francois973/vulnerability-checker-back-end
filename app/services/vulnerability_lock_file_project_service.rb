require "net/http"
require "json"

class VulnerabilityLockFileProjectService
  def initialize; end

  def call(project)
    # binding.pry
    get_url = project.url
    specs_inside_gemfile_lock = request(get_url).join
    ParserSpecGemfileLockService.new.call(specs_inside_gemfile_lock)
  end

  def request(get_url)
    files_types = ["Gemfile.lock"]
    @array_url = get_url.split("/")
    files_types.each do |file|
      url = URI("https://raw.githubusercontent.com/#{@array_url[3]}/#{@array_url[4]}/master/#{file}")
      res = Net::HTTP.get(url)
      JSON.parse(res.to_json)
    end
  end
end
