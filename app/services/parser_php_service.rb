require "json"

class ParserPhpService
  def initialize(file_content)
    @file_content = file_content
  end

  def call
    file = Tempfile.new("composer.lock")
    file.write(@file_content)
    file.close
    lock_file = File.read(file.path)
    lock_data = JSON.parse(lock_file)
    arr_specs = []

    lock_data["packages"].each do |package|
      arr_specs << {
        name:    package["name"],
        version: Gem::Version.new(format_versions(package["version"]))
      }
    end
    file.unlink
    arr_specs
  end

  def format_versions(version)
    version.include?("v") ? version.gsub("v", "") : version
  end
end
